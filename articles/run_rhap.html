<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>run_rhap • rhap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="run_rhap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rhap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>

  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fas fa-clipboard-list"></span>

    Guides

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/run_rhap.html">Running rhap: Calculate household air pollution (HAP) impacts</a>
    </li>
    <li>
      <a href="../articles/fit_model.html">Fitting the econometric model</a>
    </li>
    <li>
      <a href="../articles/ResidEm_grp.html">Analyze within-region contributions to HAP</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>

    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>

    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bc3LC/rhap" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>run_rhap</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bc3LC/rhap/blob/k_dev/vignettes/run_rhap.Rmd" class="external-link"><code>vignettes/run_rhap.Rmd</code></a></small>
      <div class="hidden name"><code>run_rhap.Rmd</code></div>

    </div>

    
    
<p>The primary function provided by this package is
<code>calc_hap_impacts</code>, which is designed to estimate health
impacts attributable to household air pollution (HAP) under various
alternative scenarios simulated using the Global Change Analysis Model
(GCAM). This function streamlines the process of assessing
scenario-specific health outcomes by extracting relevant data from GCAM
databases or project files. These relevant data includes key
socioeconomic and environmental parameters, such as per capita GDP,
emissions of primary PM2.5, NOx, and VOCs, as well as per capita
floorspace. For more details on the methodology and assumptions
underlying the econometric model used in this calculation, refer to the
guide on <a href="ADD%20link">“Fitting the Econometric Model”</a>.</p>
<div class="section level3">
<h3 id="extraction-of-the-scenario-specific-data">Extraction of the scenario-specific data<a class="anchor" aria-label="anchor" href="#extraction-of-the-scenario-specific-data"></a>
</h3>
<p>The function <code>calc_hap_impacts</code> connects to a GCAM
databases or project file using the <a href="https://github.com/JGCRI/rgcam" class="external-link">rgcam</a> package, designed to
extract and import GCAM results.</p>
<p>First, the function extracts direct air pollutant emissions from the
residential sector for each simulated GCAM scenario, GCAM region,
period, and pollutant. To estimate country-specific impacts, these
emissions are processed and downscaled to the country level using a
static downscaling approach. This approach leverages gas-specific
country-level emissions data, specifically using 2017 emissions data
from the Community Emissions Data System (CEDS), updated for the Global
Burden of Disease - Major Air Pollution Sources project<a href="https://zenodo.org/record/3754964#.Y5CFtHbMKUl" class="external-link">CEDS-GBD</a>.
Additionally, the function applies transformations such as converting
black carbon and organic carbon emissions into primary PM2.5 to ensure
comprehensive pollutant accounting.</p>
<p>The function also extracts per capita floorspace, which is calculated
endogenously in GCAM by region and period. This calculation relies on a
Gompertz-type function calibrated with empirical data (<a href="https://iopscience.iop.org/article/10.1088/1748-9326/ac43df/meta" class="external-link">Sampedro
et al 2022</a>), providing a income-driven estimate of future
residential space per person.</p>
<p>For per capita GDP, the package loads projections from the <a href="https://data.ece.iiasa.ac.at/ssp/" class="external-link">SSP database version
3.0.1</a>,updated in 2024. These GDP projections are scenario-specific,
corresponding to the Shared Socioeconomic Pathways (SSPs). By default,
the package utilizes SSP2 (“middle of the road”) projections. However,
if the GCAM scenario name includes a different SSP designation (e.g.,
“Reference_SSP3”), the package automatically selects the appropriate
SSP-specific GDP projections.</p>
</div>
<div class="section level3">
<h3 id="calculations">Calculations<a class="anchor" aria-label="anchor" href="#calculations"></a>
</h3>
<p>The function estimates health impacts attributable to household air
pollution (HAP) using an econometric model that incorporates direct
emissions from the residential sector (BC, OC, NOx, and VOC), per capita
GDP, and per capita floorspace as covariates. The model is a
fixed-effects model, estimated using cross-regional and multi-year panel
data compiled from various different sources. Detailed information on
the econometric model, including its formulation and data sources, is
available in the dedicated vignette: <a href="ADD%20link">“Fitting the
Econometric Model”</a>.</p>
<p>To improve accuracy, the health impact predictions incorporate a
country-specific “bias adder” parameter, calculated as the difference
between observed and estimated values in the final observed year (2019).
This adjustment helps align model estimates with observed data for each
country.</p>
<p>The package provides flexibility to calculate three distinct health
impact metrics associated with HAP:</p>
<ul>
<li>Premature Mortalities</li>
<li>Years of Life Lost (YLLs)</li>
<li>Disability-Adjusted Life Years (DALYs)</li>
</ul>
<p>In addition to country-level estimates, the package offers an
optional feature to estimate health impacts by socioeconomic group
(e.g., income deciles) within each region. While it is recommended to
perform country-level calculations for consistency, this capability can
provide valuable insights into the distribution of health impacts across
population segments within regions. Such granularity can aid users in
understanding intra-regional disparities. This feature is activated by
setting <code>by_gr = F</code>.</p>
</div>
<div class="section level3">
<h3 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h3>
<p>The function calculates health impacts—such as deaths, Years of Life
Lost (YLLs), or Disability-Adjusted Life Years (DALYs)—attributable to
household air pollution (HAP) for each country, time period, and GCAM
scenario. By using the <code>normalized</code> parameter, users can
choose between producing results in absolute terms or as normalized
values (per 100,000 inhabitants), offering flexibility for different
analytical needs.</p>
<p>If <code>saveOutput</code> is set to <code>TRUE</code>, the function
writes the following csv files in the <code>output/</code>
sub-directory: <code>[scenario]_HAP_HIAvar.csv</code></p>
<p>In addition, by setting <code>map</code> to <code>TRUE</code>, the
function generates damage maps, using the <a href="https://github.com/JGCRI/rmap" class="external-link">rmap</a> package documented in the
following <a href="https://jgcri.github.io/rmap/" class="external-link">page</a>. The function
also generates animations and individual figures.</p>
</div>
<div class="section level3">
<h3 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(rhap)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> db_path <span class="ot">&lt;-</span> <span class="st">"path_to_your_gcam_database"</span> <span class="co"># NULL if project file provided</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a> db_name <span class="ot">&lt;-</span> <span class="st">"name of the database"</span> <span class="co"># NULL if project file provided</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a> prj_name<span class="ot">&lt;-</span><span class="st">"name of the project file"</span>, <span class="co"># or name for a project to add extracted results to (any name should work, avoid spaces just in case)</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a> scen_name <span class="ot">&lt;-</span> <span class="st">"name of the GCAM scenario"</span> <span class="co"># or vector names of the GCAM scenarios to be processed</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a> queries <span class="ot">&lt;-</span> <span class="st">"Name of the query file"</span> <span class="co"># (the package includes a default query file that includes all the queries required in every function in the package, "queries_rhap.xml")</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a> </span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a> hap_damages <span class="ot">&lt;-</span> calc_hap_impacts <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">db_path =</span> <span class="cn">NULL</span>, <span class="at">query_path =</span> <span class="st">"./inst/extdata"</span>, <span class="at">db_name =</span> <span class="cn">NULL</span>, prj_name,</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>                scen_name, <span class="at">queries =</span> <span class="st">"queries_rhap.xml"</span>, <span class="at">final_db_year =</span> <span class="dv">2100</span>,</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>                <span class="at">saveOutput =</span> T, <span class="at">map =</span> F, <span class="at">anim =</span> T , <span class="at">HIA_var =</span> <span class="st">"deaths"</span>,</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>                <span class="at">normalized =</span> F, <span class="at">by_gr =</span> F)</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a> <span class="fu">head</span>(hap_damages)</span></code></pre></div>
<!-------------------------->
<!-------------------------->
<p align="center" style="font-size:18px;">
<em>Premature deaths per 100.000 inhabitants attributable to household
air pollution in 2050</em>
</p>
#
<p align="center">
<img src="https://raw.githubusercontent.com/bc3LC/rhap/main/vignettes/vignetteFigs/map_base_2050.png"></p>
<!-------------------------->
<!-------------------------->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jon Sampedro, Clàudia Rodés-Bachs, Steven Smith, Manuel Tomas, Ismael Urrutia, Dirk-Jan Van de Ven.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
